<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Implementation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Test Implementation - Book Now Button</h1>
    
    <div class="test-case">
        <h2>Test 1: User Not Logged In</h2>
        <p>When user is not logged in and clicks "Book Now":</p>
        <ul>
            <li>Should show "Please login first" toast message</li>
            <li>Should redirect to login.html after 1.2 seconds</li>
        </ul>
        <button onclick="testNotLoggedIn()">Run Test</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-case">
        <h2>Test 2: User Logged In</h2>
        <p>When user is logged in and clicks "Book Now":</p>
        <ul>
            <li>Should redirect to book.html with car ID parameter</li>
        </ul>
        <button onclick="testLoggedIn()">Run Test</button>
        <div id="test2-result"></div>
    </div>

    <script>
        function testNotLoggedIn() {
            // Clear any existing auth token
            localStorage.removeItem('authToken');
            
            // Mock the showToast function
            window.showToast = function(message, duration, color) {
                const result = document.getElementById('test1-result');
                result.innerHTML = `<p class="success">✓ Toast shown: "${message}"</p>`;
                
                // Check if redirect happens after timeout
                setTimeout(() => {
                    result.innerHTML += `<p class="success">✓ Redirect to login.html triggered</p>`;
                }, 1200);
            };
            
            // Call the handleBookNow function
            handleBookNow('test-car-id');
        }

        function testLoggedIn() {
            // Set a mock auth token
            localStorage.setItem('authToken', JSON.stringify({
                token: 'mock-token',
                expiresAt: Date.now() + 3600000
            }));
            
            // Mock window.location.href to capture the redirect
            const originalLocation = window.location.href;
            Object.defineProperty(window.location, 'href', {
                writable: true,
                value: originalLocation
            });
            
            let redirectUrl = '';
            Object.defineProperty(window.location, 'href', {
                set: function(value) {
                    redirectUrl = value;
                    const result = document.getElementById('test2-result');
                    if (value.includes('book.html?carId=test-car-id')) {
                        result.innerHTML = `<p class="success">✓ Redirected to: ${value}</p>`;
                    } else {
                        result.innerHTML = `<p class="error">✗ Unexpected redirect: ${value}</p>`;
                    }
                },
                get: function() {
                    return redirectUrl;
                }
            });
            
            // Call the handleBookNow function
            handleBookNow('test-car-id');
            
            // Restore original location after test
            setTimeout(() => {
                Object.defineProperty(window.location, 'href', {
                    writable: true,
                    value: originalLocation
                });
            }, 100);
        }

        // Handle Book Now button click
        function handleBookNow(carId) {
            const token = localStorage.getItem("authToken");
            if (!token) {
                showToast("Please login first", 3000, "#f44336");
                setTimeout(() => (window.location.href = "login.html"), 1200);
                return;
            }
            // Redirect to book.html with the selected car ID
            window.location.href = `book.html?carId=${carId}`;
        }
    </script>
</body>
</html>
