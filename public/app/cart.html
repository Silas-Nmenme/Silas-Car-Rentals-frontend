<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Cart - Silas Car Rentals</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="navbar">
  <div class="container nav-inner">
    <a href="index.html" class="brand">
      <div class="brand-mark">SC</div>
      <span class="brand-name">Silas Car Rentals</span>
    </a>
    <nav class="nav-links">
      <a class="nav-link" href="index.html#browse">Browse</a>
      <a class="nav-link" href="book.html">Book</a>
    </nav>
    <div class="nav-actions">
      <button class="btn btn-ghost" onclick="location.href='cart.html'">üßæ Cart (<span id="cart-count">0</span>)</button>
      <button class="btn btn-ghost" onclick="location.href='wishlist.html'">‚ù§Ô∏è Wishlist (<span id="wishlist-count">0</span>)</button>
      <button class="btn btn-ghost" onclick="location.href='saved.html'">üíæ Saved (<span id="saved-count">0</span>)</button>
    </div>
  </div>
</header>

<main class="section container">
  <h1>My Booking Cart</h1>
  <button class="btn btn-outline" style="margin-bottom:15px" onclick="clearCart()">Clear Cart</button>
  <div id="cart-items" class="grid" style="gap:20px; margin-top:20px;"></div>
</main>

<div class="toast" id="toast"></div>

<script>
function getStorage(key) { return JSON.parse(localStorage.getItem(key)) || []; }
function setStorage(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
function updateCounts() {
  document.getElementById("cart-count").textContent = getStorage("cart").length;
  document.getElementById("wishlist-count").textContent = getStorage("wishlist").length;
  document.getElementById("saved-count").textContent = getStorage("savedCars").length;
}
function showToast(msg, ms=3000) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), ms);
}
function renderCart() {
  const cart = getStorage("cart");
  const container = document.getElementById("cart-items");
  if (!cart.length) { container.innerHTML = "<p>Your cart is empty.</p>"; return; }
  container.innerHTML = cart.map(car => `
    <div class="car-card">
      <img src="${car.image || 'https://via.placeholder.com/300'}" alt="${car.make}" style="width:100%; border-radius:8px;">
      <h3>${car.make} ${car.model}</h3>
      <p><strong>‚Ç¶${car.price.toLocaleString()}</strong> / day</p>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
        <button class="btn" onclick='checkoutCar(${JSON.stringify(car).replace(/"/g, "&quot;")})'>Book Now</button>
        <button class="btn btn-outline" onclick='moveToWishlist("${car._id}")'>Move to Wishlist</button>
        <button class="btn btn-outline" onclick='moveToSaved("${car._id}")'>Move to Saved</button>
        <button class="btn btn-outline" onclick='removeFromCart("${car._id}")'>Remove</button>
      </div>
    </div>
  `).join("");
}
function checkoutCar(car) {
  localStorage.setItem("currentCar", JSON.stringify(car));
  window.location.href = "book.html";
}
function moveToWishlist(id) {
  let wishlist = getStorage("wishlist");
  let cart = getStorage("cart");
  const car = cart.find(c => c._id === id);
  if (car && !wishlist.find(c => c._id === id)) {
    wishlist.push(car);
    setStorage("wishlist", wishlist);
    removeFromCart(id, false);
    showToast("Moved to wishlist");
  } else showToast("Already in wishlist");
}
function moveToSaved(id) {
  let saved = getStorage("savedCars");
  let cart = getStorage("cart");
  const car = cart.find(c => c._id === id);
  if (car && !saved.find(c => c._id === id)) {
    saved.push(car);
    setStorage("savedCars", saved);
    removeFromCart(id, false);
    showToast("Moved to saved cars");
  } else showToast("Already in saved cars");
}
function removeFromCart(id, toast=true) {
  let cart = getStorage("cart").filter(c => c._id !== id);
  setStorage("cart", cart);
  updateCounts();
  renderCart();
  if (toast) showToast("Car removed from cart");
}
function clearCart() {
  setStorage("cart", []);
  updateCounts();
  renderCart();
  showToast("Cart cleared");
}
updateCounts();
renderCart();
</script>

<style>
.toast { position: fixed; bottom: 1.5rem; left: 50%; transform: translateX(-50%); background: #03dac5; color: #121212; padding: 0.7rem 1.2rem; border-radius: 4px; font-weight: 600; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 9999; }
.toast.show { opacity: 1; }
.car-card { border: 1px solid #333; border-radius: 8px; padding: 1rem; background: #1f1f1f; color: #fff; }
.btn { background: #03dac5; border: none; color: #121212; padding: 0.6rem 1rem; border-radius: 6px; cursor: pointer; font-weight: bold; }
.btn-outline { background: transparent; border: 2px solid #03dac5; color: #03dac5; }
.btn:hover { background: #00b2a9; }
.btn-outline:hover { background: #03dac5; color: #121212; }
</style>
</body>
</html>
