<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test Booking System - Silas Car Rentals</title>
  <link rel="stylesheet" href="style.css" />
  <script src="booking-fix.js"></script>
  <style>
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }
    .test-section {
      background: white;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-button {
      margin: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .test-button:hover {
      background: #0056b3;
    }
    .test-result {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 4px;
      background: #f8f9fa;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
  </style>
</head>
<body>
<header class="navbar">
  <div class="container nav-inner">
    <a href="index.html" class="brand">
      <div class="brand-mark">SC</div>
      <span class="brand-name">Silas Car Rentals</span>
    </a>
  </div>
</header>

<main class="test-container">
  <h1>Booking System Test</h1>
  
  <div class="test-section">
    <h2>1. Test Booking Data Management</h2>
    <button class="test-button" onclick="testSetBooking()">Test Set Booking</button>
    <button class="test-button" onclick="testGetBooking()">Test Get Booking</button>
    <button class="test-button" onclick="testClearBooking()">Test Clear Booking</button>
    <button class="test-button" onclick="testValidation()">Test Validation</button>
    <div id="test-result-1" class="test-result"></div>
  </div>

  <div class="test-section">
    <h2>2. Test Booking Flow</h2>
    <button class="test-button" onclick="testBookToCheckout()">Test Book → Checkout</button>
    <button class="test-button" onclick="testCartToBook()">Test Cart → Book</button>
    <button class="test-button" onclick="testCheckoutToOrder()">Test Checkout → Order</button>
    <div id="test-result-2" class="test-result"></div>
  </div>

  <div class="test-section">
    <h2>3. Current Booking Status</h2>
    <button class="test-button" onclick="showCurrentBooking()">Show Current Booking</button>
    <div id="current-booking" class="test-result"></div>
  </div>

  <div class="test-section">
    <h2>4. Navigation Tests</h2>
    <button class="test-button" onclick="window.location.href='book.html'">Go to Book Page</button>
    <button class="test-button" onclick="window.location.href='cart.html'">Go to Cart Page</button>
    <button class="test-button" onclick="window.location.href='checkout.html'">Go to Checkout</button>
    <button class="test-button" onclick="window.location.href='order.html'">Go to Order Summary</button>
  </div>
</main>

<script>
function showResult(sectionId, message, type = 'info') {
  const resultDiv = document.getElementById(sectionId);
  resultDiv.innerHTML = `<div class="${type}">${message}</div>`;
}

function testSetBooking() {
  try {
    const testCar = {
      _id: 'test-car-123',
      make: 'Toyota',
      model: 'Camry',
      year: 2023,
      price: 15000,
      image: 'https://via.placeholder.com/300'
    };
    
    const bookingData = {
      car: testCar,
      pickupDate: '2024-01-15',
      returnDate: '2024-01-17',
      email: 'test@example.com',
      phoneNumber: '+2348012345678'
    };
    
    const result = BookingManager.setBooking(bookingData);
    
    if (result) {
      showResult('test-result-1', 
        '✅ Booking set successfully!<br>' +
        `Car: ${result.car.make} ${result.car.model}<br>` +
        `Dates: ${result.pickupDate} to ${result.returnDate}<br>` +
        `Total: ₦${result.totalAmount.toLocaleString()}`,
        'success'
      );
    } else {
      showResult('test-result-1', '❌ Failed to set booking', 'error');
    }
  } catch (error) {
    showResult('test-result-1', `❌ Error: ${error.message}`, 'error');
  }
}

function testGetBooking() {
  try {
    const booking = BookingManager.getBooking();
    if (booking) {
      showResult('test-result-1', 
        '✅ Booking retrieved successfully!<br>' +
        `Car: ${booking.car.make} ${booking.car.model}<br>` +
        `Email: ${booking.email}`,
        'success'
      );
    } else {
      showResult('test-result-1', '❌ No booking found', 'error');
    }
  } catch (error) {
    showResult('test-result-1', `❌ Error: ${error.message}`, 'error');
  }
}

function testClearBooking() {
  try {
    BookingManager.clearBooking();
    const booking = BookingManager.getBooking();
    
    if (!booking) {
      showResult('test-result-1', '✅ Booking cleared successfully!', 'success');
    } else {
      showResult('test-result-1', '❌ Booking still exists after clear', 'error');
    }
  } catch (error) {
    showResult('test-result-1', `❌ Error: ${error.message}`, 'error');
  }
}

function testValidation() {
  try {
    // Test invalid booking (missing required fields)
    const invalidBooking = { car: { _id: 'test' } };
    const validation = BookingManager.validateBooking(invalidBooking);
    
    if (!validation.isValid && validation.errors.length > 0) {
      showResult('test-result-1', 
        '✅ Validation working correctly!<br>' +
        `Errors: ${validation.errors.join(', ')}`,
        'success'
      );
    } else {
      showResult('test-result-1', '❌ Validation failed to detect errors', 'error');
    }
  } catch (error) {
    showResult('test-result-1', `❌ Error: ${error.message}`, 'error');
  }
}

function testBookToCheckout() {
  try {
    const testCar = {
      _id: 'test-flow-456',
      make: 'Honda',
      model: 'Civic',
      year: 2024,
      price: 12000
    };
    
    const bookingData = {
      car: testCar,
      pickupDate: '2024-02-01',
      returnDate: '2024-02-03',
      email: 'flow@test.com',
      phoneNumber: '+2348098765432'
    };
    
    BookingManager.setBooking(bookingData);
    
    const validation = BookingManager.validateBooking(BookingManager.getBooking());
    
    if (validation.isValid) {
      showResult('test-result-2', 
        '✅ Book → Checkout flow ready!<br>' +
        'Booking data is valid and can proceed to checkout.',
        'success'
      );
    } else {
      showResult('test-result-2', 
        '❌ Validation failed: ' + validation.errors.join(', '),
        'error'
      );
    }
  } catch (error) {
    showResult('test-result-2', `❌ Error: ${error.message}`, 'error');
  }
}

function testCartToBook() {
  try {
    // Simulate cart item
    const cartCar = {
      _id: 'cart-car-789',
      make: 'BMW',
      model: 'X5',
      year: 2023,
      price: 25000
    };
    
    const bookingData = {
      car: cartCar,
      source: 'cart'
    };
    
    BookingManager.setBooking(bookingData);
    
    const booking = BookingManager.getBooking();
    if (booking && booking.source === 'cart') {
      showResult('test-result-2', 
        '✅ Cart → Book flow ready!<br>' +
        `Car from cart: ${booking.car.make} ${booking.car.model}<br>` +
        'Redirect to book.html?carId=' + booking.car._id,
        'success'
      );
    } else {
      showResult('test-result-2', '❌ Cart flow setup failed', 'error');
    }
  } catch (error) {
    showResult('test-result-2', `❌ Error: ${error.message}`, 'error');
  }
}

function testCheckoutToOrder() {
  try {
    const booking = BookingManager.getBooking();
    if (booking) {
      showResult('test-result-2', 
        '✅ Checkout → Order flow ready!<br>' +
        'Booking data is available for order summary.<br>' +
        'Order page will clear booking after display.',
        'success'
      );
    } else {
      showResult('test-result-2', 
        '⚠️ No booking found. Set up a booking first.',
        'info'
      );
    }
  } catch (error) {
    showResult('test-result-2', `❌ Error: ${error.message}`, 'error');
  }
}

function showCurrentBooking() {
  try {
    const booking = BookingManager.getBooking();
    if (booking) {
      const days = BookingManager.calculateDays(booking.pickupDate, booking.returnDate);
      const total = booking.totalAmount || (booking.car.price * days);
      
      const html = `
        <strong>Current Booking:</strong><br>
        Car: ${booking.car.make} ${booking.car.model} (${booking.car.year})<br>
        Price: ₦${booking.car.price.toLocaleString()}/day<br>
        Dates: ${booking.pickupDate} to ${booking.returnDate}<br>
        Duration: ${days} days<br>
        Total: ₦${total.toLocaleString()}<br>
        Email: ${booking.email || 'Not set'}<br>
        Phone: ${booking.phoneNumber || 'Not set'}<br>
        Source: ${booking.source || 'Not set'}<br>
        Created: ${booking.createdAt ? new Date(booking.createdAt).toLocaleString() : 'Unknown'}
      `;
      
      showResult('current-booking', html, 'info');
    } else {
      showResult('current-booking', 'No current booking', 'info');
    }
  } catch (error) {
    showResult('current-booking', `Error: ${error.message}`, 'error');
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  showCurrentBooking();
});
</script>
</body>
</html>
