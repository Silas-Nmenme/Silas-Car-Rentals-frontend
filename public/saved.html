<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Saved Cars - Silas Car Rentals</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="navbar">
  <div class="container nav-inner">
    <a href="index.html" class="brand">
      <div class="brand-mark">SC</div>
      <span class="brand-name">Silas Car Rentals</span>
    </a>
    <nav class="nav-links">
      <a class="nav-link" href="index.html#browse">Browse</a>
      <a class="nav-link" href="book.html">Book</a>
    </nav>
    <div class="nav-actions">
      <button class="btn btn-ghost" onclick="location.href='cart.html'">üßæ Cart (<span id="cart-count">0</span>)</button>
      <button class="btn btn-ghost" onclick="location.href='wishlist.html'">‚ù§Ô∏è Wishlist (<span id="wishlist-count">0</span>)</button>
      <button class="btn btn-ghost" onclick="location.href='saved.html'">üíæ Saved (<span id="saved-count">0</span>)</button>
    </div>
  </div>
</header>

<main class="section container">
  <h1>My Saved Cars</h1>
  <button class="btn btn-outline" style="margin-bottom:15px" onclick="clearSaved()">Clear All</button>
  <div id="saved-items" class="grid" style="gap:20px; margin-top:20px;"></div>
</main>

<div class="toast" id="toast"></div>

<script src="booking-fix.js"></script>
<script>
function getStorage(key) { return JSON.parse(localStorage.getItem(key)) || []; }
function setStorage(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
function updateCounts() {
  document.getElementById("cart-count").textContent = getStorage("cart").length;
  document.getElementById("wishlist-count").textContent = getStorage("wishlist").length;
  document.getElementById("saved-count").textContent = getStorage("savedCars").length;
}
function showToast(msg, ms=3000) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), ms);
}
function renderSaved() {
  const list = getStorage("savedCars");
  const container = document.getElementById("saved-items");
  if (!list.length) { container.innerHTML = "<p>You haven't saved any cars.</p>"; return; }
  container.innerHTML = list.map(car => `
    <div class="car-card">
      <img src="${car.image || 'https://via.placeholder.com/300'}" alt="${car.make}" loading="lazy" style="width:100%; border-radius:8px;">
      <h3>${car.make} ${car.model}</h3>
      <p><strong>‚Ç¶${car.price.toLocaleString()}</strong> / day</p>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
        <button class="btn" onclick='checkoutCar(${JSON.stringify(car).replace(/"/g, "&quot;")})'>Book Now</button>
        <button class="btn btn-outline" onclick='moveToCart("${car._id}")'>Move to Cart</button>
        <button class="btn btn-outline" onclick='moveToWishlist("${car._id}")'>Move to Wishlist</button>
        <button class="btn btn-outline" onclick='removeFromSaved("${car._id}")'>Remove</button>
      </div>
    </div>
  `).join("");
}
function checkoutCar(car) {
  // Use BookingManager to set booking data
  if (typeof BookingManager !== 'undefined') {
    BookingManager.setBooking({
      car: car,
      source: 'saved'
    });
    window.location.href = "book.html?carId=" + car._id;
  } else {
    // Fallback to old method if BookingManager not available
    localStorage.setItem("currentCar", JSON.stringify(car));
    window.location.href = "book.html";
  }
}
function moveToCart(id) {
  let cart = getStorage("cart");
  let saved = getStorage("savedCars");
  const car = saved.find(c => c._id === id);
  if (car && !cart.find(c => c._id === id)) {
    cart.push(car);
    setStorage("cart", cart);
    removeFromSaved(id);
    showToast("Moved to cart");
  } else showToast("Already in cart");
}
function moveToWishlist(id) {
  let wishlist = getStorage("wishlist");
  let saved = getStorage("savedCars");
  const car = saved.find(c => c._id === id);
  if (car && !wishlist.find(c => c._id === id)) {
    wishlist.push(car);
    setStorage("wishlist", wishlist);
    removeFromSaved(id);
    showToast("Moved to wishlist");
  } else showToast("Already in wishlist");
}
function removeFromSaved(id) {
  let list = getStorage("savedCars").filter(c => c._id !== id);
  setStorage("savedCars", list);
  updateCounts();
  renderSaved();
  showToast("Removed from saved cars");
}
function clearSaved() {
  setStorage("savedCars", []);
  updateCounts();
  renderSaved();
  showToast("Saved cars cleared");
}
updateCounts();
renderSaved();
</script>

<style>
.toast { position: fixed; bottom: 1.5rem; left: 50%; transform: translateX(-50%); background: #03dac5; color: #121212; padding: 0.7rem 1.2rem; border-radius: 4px; font-weight: 600; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 9999; }
.toast.show { opacity: 1; }
.car-card { border: 1px solid #333; border-radius: 8px; padding: 1rem; background: #1f1f1f; color: #fff; }
.btn { background: #03dac5; border: none; color: #121212; padding: 0.6rem 1rem; border-radius: 6px; cursor: pointer; font-weight: bold; }
.btn-outline { background: transparent; border: 2px solid #03dac5; color: #03dac5; }
.btn:hover { background: #00b2a9; }
.btn-outline:hover { background: #03dac5; color: #121212; }
</style>
</body>
</html>
