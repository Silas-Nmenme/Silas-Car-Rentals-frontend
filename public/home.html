<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Silas Car Rentals - Dashboard</title>

  <!-- Bootstrap 5.3.2 (Responsive & Mobile-first) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <!-- Animate.css -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet"/>
  <!-- AOS -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"/>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <!-- Tailwind CSS for modern utility styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Hover.css for enhanced hover effects -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.3.1/css/hover-min.css">
  <style>
    /* Mobile responsiveness adjustments */
    @media (max-width: 768px) {
      #welcome-avatar {
        width: 50px !important;
        height: 50px !important;
        font-size: 1rem !important;
      }
      .card-img-top {
        height: 200px;
        object-fit: cover;
      }
      .navbar .d-flex.align-items-center.gap-3 {
        gap: 0.25rem !important; /* Reduced gap for better balance */
      }
      .navbar .btn {
        padding: 0.25rem 0.375rem; /* Smaller padding */
        font-size: 0.8rem; /* Smaller font */
      }
      .navbar .badge {
        font-size: 0.7rem; /* Smaller badge */
        padding: 0.2em 0.4em; /* Adjust badge padding */
      }
      .navbar-brand {
        font-size: 1.1rem; /* Slightly smaller brand */
      }
      #nav-avatar {
        width: 28px !important;
        height: 28px !important;
        font-size: 0.8rem !important;
      }
      .dropdown-menu {
        min-width: 150px; /* Narrower dropdown */
      }
      /* Balance header: Center brand, distribute right elements evenly */
      .navbar .container-fluid {
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
      }
      .navbar-brand {
        flex: 1;
        text-align: center;
        order: 2;
      }
      .navbar .ms-auto.d-flex.align-items-center.gap-3 {
        flex: 1;
        justify-content: space-around;
        order: 3;
        gap: 0.5rem !important;
      }
      .navbar .d-none.d-md-flex {
        order: 1;
        flex: 1;
        justify-content: flex-start;
      }
      .navbar .btn-outline-success.d-lg-none {
        order: 0;
      }
    }
    @media (max-width: 576px) {
      .navbar-brand {
        font-size: 1rem;
      }
      #welcome-user {
        font-size: 1.25rem;
      }
      .card-body.d-flex.flex-column .btn {
        font-size: 0.875rem;
      }
      .quick-stats .card {
        padding: 1rem 0.5rem;
      }
      .quick-stats .card i {
        font-size: 1.5rem;
      }
      .navbar .d-flex.align-items-center {
        flex-wrap: wrap; /* Allow wrapping if needed */
        justify-content: space-around; /* Distribute evenly */
        gap: 0.25rem !important;
      }
      .navbar .btn {
        padding: 0.2rem 0.3rem;
        font-size: 0.75rem;
      }
      .navbar .badge {
        font-size: 0.65rem;
        padding: 0.15em 0.3em;
      }
      #nav-avatar {
        width: 24px !important;
        height: 24px !important;
        font-size: 0.7rem !important;
      }
      .dropdown-menu {
        min-width: 120px;
      }
      /* Further balance: Stack elements if needed */
      .navbar .container-fluid {
        flex-direction: column;
        align-items: stretch;
      }
      .navbar-brand {
        text-align: center;
        margin-bottom: 0.5rem;
      }
      .navbar .ms-auto.d-flex.align-items-center.gap-3 {
        justify-content: center;
        flex-wrap: wrap;
      }
    }
    @media (max-width: 480px) {
      .navbar-brand {
        font-size: 0.9rem;
      }
      .navbar .d-flex.align-items-center.gap-3 {
        gap: 0.1rem !important;
      }
      .navbar .btn {
        padding: 0.15rem 0.25rem;
        font-size: 0.7rem;
      }
      .navbar .badge {
        font-size: 0.6rem;
        padding: 0.1em 0.25em;
      }
      #nav-avatar {
        width: 20px !important;
        height: 20px !important;
        font-size: 0.6rem !important;
      }
      .dropdown-menu {
        min-width: 100px;
        font-size: 0.8rem;
      }
      .dropdown-item {
        padding: 0.25rem 0.5rem;
      }
      /* Compact and balanced: Minimize gaps, center align */
      .navbar .container-fluid {
        padding: 0.5rem;
      }
      .navbar .ms-auto.d-flex.align-items-center.gap-3 {
        justify-content: space-between;
        gap: 0 !important;
      }
      .navbar .btn {
        min-width: 2rem;
      }
    }
  </style>
</head>
<body style="font-family:'Inter',sans-serif;" class="pt-20">

<!-- Header -->
<header class="bg-gradient-to-r from-teal-500 to-teal-600 py-4 shadow-lg fixed top-0 left-0 right-0 z-50 backdrop-blur-md">
  <nav class="navbar navbar-expand-lg container mx-auto">
    <!-- Sidebar toggle button for mobile -->
    <button class="btn btn-outline-light d-lg-none me-2 hvr-bounce-in" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-label="Open menu" title="Open menu">
      <i class="fas fa-bars"></i>
    </button>

    <a href="home.html" class="text-white text-xl font-bold no-underline hover:scale-105 transition-transform duration-300"><i class="fas fa-car me-2"></i>Silas Car Rentals</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" title="Toggle navigation" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link text-white font-semibold px-4 py-2 rounded-md hover:bg-white hover:bg-opacity-20 transition-all duration-300" href="#home">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white font-semibold px-4 py-2 rounded-md hover:bg-white hover:bg-opacity-20 transition-all duration-300" href="#services">Services</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white font-semibold px-4 py-2 rounded-md hover:bg-white hover:bg-opacity-20 transition-all duration-300" href="#about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white font-semibold px-4 py-2 rounded-md hover:bg-white hover:bg-opacity-20 transition-all duration-300" href="#contact">Contact</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white font-semibold px-4 py-2 rounded-md hover:bg-white hover:bg-opacity-20 transition-all duration-300" href="login.html">Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white font-semibold px-4 py-2 rounded-md hover:bg-white hover:bg-opacity-20 transition-all duration-300" href="signup.html">Signup</a>
        </li>
      </ul>

      <div class="ms-auto flex items-center gap-3">
        <!-- Notifications -->
        <div class="dropdown">
          <button class="btn btn-outline-light hvr-bounce-in" data-bs-toggle="dropdown" aria-label="Notifications" title="Notifications"><i class="fas fa-bell"></i></button>
          <ul class="dropdown-menu dropdown-menu-end" id="notifications">
            <li class="dropdown-header fw-bold">Notifications</li>
            <li><a class="dropdown-item" href="#">ðŸš— New BMW X5 added to fleet</a></li>
            <li><a class="dropdown-item" href="#">ðŸ”¥ 20% off luxury rentals this week</a></li>
            <li><a class="dropdown-item" href="#">âœ… Your booking was confirmed</a></li>
          </ul>
        </div>
        <!-- Counters -->
        <a href="cart.html" class="btn btn-outline-light position-relative hvr-bounce-in" aria-label="Cart">
          <i class="fas fa-shopping-cart"></i>
          <span id="cart-count" class="badge bg-success position-absolute top-0 start-100 translate-middle">0</span>
        </a>
        <a href="wishlist.html" class="btn btn-outline-light position-relative hvr-bounce-in" aria-label="Wishlist">
          <i class="fas fa-heart"></i>
          <span id="wishlist-count" class="badge bg-danger position-absolute top-0 start-100 translate-middle">0</span>
        </a>
        <a href="saved.html" class="btn btn-outline-light position-relative hvr-bounce-in" aria-label="Saved">
          <i class="fas fa-bookmark"></i>
          <span id="saved-count" class="badge bg-warning position-absolute top-0 start-100 translate-middle">0</span>
        </a>
        <!-- Theme -->
        <button class="bg-white bg-opacity-20 text-white p-2 rounded-full hover:scale-110 transition-transform duration-300 ms-3" id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
          <i class="fas fa-moon" aria-hidden="true"></i>
          <span class="sr-only">Toggle theme</span>
        </button>
        <!-- Profile -->
        <div class="dropdown">
          <button class="btn btn-light d-flex align-items-center hvr-bounce-in" data-bs-toggle="dropdown" aria-label="Profile menu" title="Profile menu">
            <div id="nav-avatar" class="rounded-full me-2 flex items-center justify-center bg-success text-white font-bold" style="width:32px; height:32px; font-size:0.9rem;"></div>
            <span id="user-name">User</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user me-2"></i>Profile</a></li>
            <li><a class="dropdown-item" href="orders.html"><i class="fas fa-box me-2"></i>My Orders</a></li>
            <li><button class="dropdown-item text-danger" id="logout-button"><i class="fas fa-sign-out-alt me-2"></i>Logout</button></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
</header>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar Offcanvas -->
    <div class="offcanvas offcanvas-start bg-light" tabindex="-1" id="sidebarMenu">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title fw-bold text-success"><i class="fas fa-car me-2"></i>Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" title="Close menu"></button>
      </div>
      <div class="offcanvas-body p-3">
        <h6 class="text-muted mb-3">Dashboard</h6>
        <ul class="nav flex-column gap-2" id="sidebar-links"></ul>
      </div>
    </div>

    <!-- Sidebar Desktop -->
    <aside class="col-md-3 col-lg-2 bg-light border-end min-vh-100 p-3 d-none d-lg-block">
      <h6 class="text-muted mb-3">Dashboard</h6>
      <ul class="nav flex-column gap-2" id="sidebar-links-desktop"></ul>
    </aside>

    <!-- Main -->
    <main class="col-md-9 col-lg-10 p-4 main bg-gray-50 min-h-screen">
      <!-- Welcome -->
      <div class="mb-4 animate__animated animate__fadeIn flex items-center gap-3 welcome-section bg-white p-4 rounded-lg shadow-md">
        <div id="welcome-avatar" class="rounded-full border flex items-center justify-center bg-green-500 text-white font-bold" style="width:60px; height:60px; font-size:1.2rem;"></div>
        <div>
          <h2 class="font-bold mb-1 text-2xl"> Hello <span id="welcome-user"></span> ðŸ‘‹</h2>
          <p class="text-gray-600">Welcome to your professional dashboard. Manage your rentals and discover new cars.</p>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="row g-3 mb-4" data-aos="fade-up">
        <div class="col-md-4">
          <div class="card text-center p-3 shadow-lg bg-white hover:shadow-xl transition-shadow duration-300 hvr-grow">
            <i class="fas fa-shopping-cart text-green-500 fa-2x mb-2"></i>
            <h6 class="font-semibold">Cart</h6>
            <p id="stat-cart">0 items</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center p-3 shadow-lg bg-white hover:shadow-xl transition-shadow duration-300 hvr-grow">
            <i class="fas fa-heart text-red-500 fa-2x mb-2"></i>
            <h6 class="font-semibold">Wishlist</h6>
            <p id="stat-wishlist">0 items</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center p-3 shadow-lg bg-white hover:shadow-xl transition-shadow duration-300 hvr-grow">
            <i class="fas fa-bookmark text-yellow-500 fa-2x mb-2"></i>
            <h6 class="font-semibold">Saved Cars</h6>
            <p id="stat-saved">0 items</p>
          </div>
        </div>
      </div>

      <!-- Recommended -->
      <div class="mb-4" data-aos="fade-up">
        <h5 class="font-bold text-xl mb-3 section-title">Recommended for You</h5>
        <div class="row g-3" id="recommended-cars"></div>
      </div>

      <!-- Recent Rentals -->
      <div class="mb-4" data-aos="fade-up">
        <h5 class="font-bold text-xl mb-3">Recent Rentals</h5>
        <ul class="list-group bg-white rounded-lg shadow-md" id="recent-rentals"></ul>
      </div>
    </main>
  </div>
</div>

<!-- Toast -->
<div class="toast position-fixed bottom-0 end-0 m-3" id="toast"><div class="toast-body"></div></div>

<!-- Footer -->
<footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white text-center py-4 shadow-lg">
  <div class="container mx-auto">
    <p class="mb-2 font-semibold">&copy; 2025 Silas Car Rentals. All Rights Reserved.</p>
    <p class="text-gray-400 text-sm">Drive with confidence. Rent with ease.</p>
  </div>
</footer>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
AOS.init();

const API_BASE = "https://techyjaunt-auth-go43.onrender.com";

const get=(k)=>JSON.parse(localStorage.getItem(k))||[];

// Sidebar links config
const sidebarLinks = [
  {href:"profile.html", icon:"fa-user", text:"Profile"},
  {href:"orders.html", icon:"fa-box", text:"Orders"},
  {href:"cart.html", icon:"fa-shopping-cart", text:"Cart"},
  {href:"wishlist.html", icon:"fa-heart", text:"Wishlist"},
  {href:"saved.html", icon:"fa-bookmark", text:"Saved"}
];

// Render sidebar with active state
function renderSidebar() {
  const current = window.location.pathname.split("/").pop();
  const linksHtml = sidebarLinks.map(l=>{
    const active = current===l.href ? "active fw-bold text-success" : "";
    return `<li><a href="${l.href}" class="nav-link ${active}"><i class="fas ${l.icon} me-2"></i>${l.text}</a></li>`;
  }).join("");
  document.getElementById("sidebar-links").innerHTML=linksHtml;
  document.getElementById("sidebar-links-desktop").innerHTML=linksHtml;
}

// Cars array
const cars = [
  { name:"Mercedes-Benz C300", price:45000, image:"https://vehicle-images.dealerinspire.com/a1a7-11002896/W1KAF4GB4SR252999/00f2d6ad30e089cb5c02791d58c3af6a.jpg", tags:["Automatic","Premium","4 Seats"], available:true },
  { name:"Toyota Camry 2023", price:25000, image:"https://images.unsplash.com/photo-1549399542-7e3f8b79c341?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80", tags:["Automatic","Executive","5 Seats"], available:true },
  { name:"BMW X5 Luxury", price:65000, image:"https://images.unsplash.com/photo-1544636331-e26879cd4d9b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80", tags:["Automatic","Luxury","7 Seats"], available:false }
];

// Render Recommended Cars
function renderRecommendedCars() {
  const container=document.getElementById("recommended-cars");
  container.innerHTML="";
  if(!cars.length){
    container.innerHTML="<p class='text-muted'>No cars available right now.</p>";
    return;
  }

  let wishlist=get("wishlist");
  let savedCars=get("savedCars");

  cars.forEach((car,i)=>{
    const badge=car.available?`<span class="badge bg-success">Available</span>`:`<span class="badge bg-warning">Limited</span>`;
    const tags=car.tags.map(t=>`<span class="badge bg-light text-dark me-1">${t}</span>`).join("");
    const wishActive=wishlist.includes(car.name)?"text-danger":"text-muted";
    const saveActive=savedCars.includes(car.name)?"text-warning":"text-muted";

    container.innerHTML+=`
      <div class="col-md-4" data-aos="fade-up" data-aos-delay="${i*100}">
        <div class="card h-100 shadow-sm">
          <div class="position-relative">
            <img src="${car.image}" class="card-img-top" alt="${car.name}" loading="lazy">
            <div class="position-absolute top-0 end-0 m-2">${badge}</div>
          </div>
          <div class="card-body d-flex flex-column">
            <h6 class="fw-bold">${car.name}</h6>
            <p class="text-success fw-bold">â‚¦${car.price.toLocaleString()}/day</p>
            <div class="mb-2">${tags}</div>
            <div class="d-flex justify-content-between mt-auto">
              <button class="btn btn-sm btn-success flex-grow-1 me-2" onclick="addToCart('${car.name}')" aria-label="Add to cart">
                <i class="fas fa-shopping-cart me-1"></i> Cart
              </button>
              <button class="btn btn-sm ${wishActive}" onclick="toggleWishlist('${car.name}', this)" aria-label="Toggle wishlist">
                <i class="fas fa-heart"></i>
              </button>
              <button class="btn btn-sm ${saveActive}" onclick="toggleSaved('${car.name}', this)" aria-label="Toggle saved">
                <i class="fas fa-bookmark"></i>
              </button>
            </div>
          </div>
        </div>
      </div>`;
  });
}

// Add to cart
function addToCart(carName){
  let cart=get("cart"); cart.push(carName);
  localStorage.setItem("cart",JSON.stringify(cart));
  updateCounts();
  addRecentRental(carName);
  pulseBadge("cart-count");
  showToast(`${carName} added to cart âœ…`);
}

// Toggle wishlist
function toggleWishlist(carName, btn){
  let wishlist=get("wishlist");
  if(wishlist.includes(carName)){
    wishlist=wishlist.filter(c=>c!==carName);
    btn.classList.replace("text-danger","text-muted");
    showToast(`${carName} removed from wishlist âŒ`);
  } else {
    wishlist.push(carName);
    btn.classList.replace("text-muted","text-danger");
    showToast(`${carName} added to wishlist â¤ï¸`);
    pulseBadge("wishlist-count");
  }
  localStorage.setItem("wishlist",JSON.stringify(wishlist));
  updateCounts();
}

// Toggle saved
function toggleSaved(carName, btn){
  let saved=get("savedCars");
  if(saved.includes(carName)){
    saved=saved.filter(c=>c!==carName);
    btn.classList.replace("text-warning","text-muted");
    showToast(`${carName} removed from saved âŒ`);
  } else {
    saved.push(carName);
    btn.classList.replace("text-muted","text-warning");
    showToast(`${carName} saved ðŸ”–`);
    pulseBadge("saved-count");
  }
  localStorage.setItem("savedCars",JSON.stringify(saved));
  updateCounts();
}

// Badge pulse animation
function pulseBadge(id){
  const badge=document.getElementById(id);
  badge.classList.add("animate__animated","animate__rubberBand");
  badge.addEventListener("animationend",()=>badge.classList.remove("animate__animated","animate__rubberBand"),{once:true});
}

// Show toast
function showToast(msg){
  const toast=document.getElementById("toast");
  toast.querySelector(".toast-body").textContent=msg;
  new bootstrap.Toast(toast).show();
}

// Recent Rentals
function renderRecentRentals(){
  const list=document.getElementById("recent-rentals");
  const rentals=get("recentRentals");
  if(!rentals.length){
    list.innerHTML="<li class='list-group-item text-muted'>No rentals yet.</li>";
    return;
  }
  list.innerHTML="";
  rentals.slice(-5).reverse().forEach(r=>{
    list.innerHTML+=`<li class="list-group-item"><i class="fas fa-car text-success me-2"></i>${r}</li>`;
  });
}
function addRecentRental(carName){
  let rentals=get("recentRentals");
  rentals.push(carName);
  localStorage.setItem("recentRentals",JSON.stringify(rentals));
  renderRecentRentals();
}

// Counts
function updateCounts(){
 document.getElementById("cart-count").textContent=get("cart").length;
 document.getElementById("wishlist-count").textContent=get("wishlist").length;
 document.getElementById("saved-count").textContent=get("savedCars").length;
 document.getElementById("stat-cart").textContent=`${get("cart").length} items`;
 document.getElementById("stat-wishlist").textContent=`${get("wishlist").length} items`;
 document.getElementById("stat-saved").textContent=`${get("savedCars").length} items`;
}

  // Personalized welcome with avatar + initials
  document.addEventListener("DOMContentLoaded", async () => {
    const userJson = localStorage.getItem("user");
    if (!userJson) {
      window.location = "login.html";
      return;
    }

    let user = JSON.parse(userJson);

    // Fetch latest profile
    try {
      const res = await fetch(`${API_BASE}/profile`, {credentials: "include"});
      if (res.ok) {
        const data = await res.json();
        user = data.user;
        localStorage.setItem("user", JSON.stringify(user));
      }
    } catch (err) {
      console.error("Failed to fetch profile:", err);
    }

    let fullName = user?.name?.trim() || user?.email?.split("@")[0] || "User";
    let firstName = fullName.split(" ")[0]; // First word only
    let initials = fullName.split(" ")
      .map(n => n[0])
      .join("")
      .substring(0, 2)
      .toUpperCase();

    // Navbar profile (full name)
    document.getElementById("user-name").textContent = fullName;

    // Dashboard greeting (first name only)
    document.getElementById("welcome-user").textContent = firstName;

    // Avatar handling (image or initials fallback)
    if (user?.profilePicture?.url || user?.avatar) {
      const imgSrc = user?.profilePicture?.url || user?.avatar;
      document.getElementById("nav-avatar").innerHTML =
        `<img src="${imgSrc}" class="rounded-circle" style="width:32px;height:32px;object-fit:cover;">`;
      document.getElementById("welcome-avatar").innerHTML =
        `<img src="${imgSrc}" class="rounded-circle border" style="width:60px;height:60px;object-fit:cover;">`;
    } else {
      document.getElementById("nav-avatar").textContent = initials;
      document.getElementById("welcome-avatar").textContent = initials;
    }

    renderSidebar();
    renderRecommendedCars();
    renderRecentRentals();
    updateCounts();
  });


// Logout
document.getElementById("logout-button").addEventListener("click",()=>{
 localStorage.clear(); window.location="login.html";
});

// Theme toggle
const themeBtn=document.getElementById("theme-toggle");
themeBtn.addEventListener("click",()=>{
 let body=document.body;
 let newTheme=body.getAttribute("data-bs-theme")==="dark"?"light":"dark";
 body.setAttribute("data-bs-theme",newTheme);
 themeBtn.innerHTML=newTheme==="dark"?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>';
 localStorage.setItem("theme",newTheme);
});
const savedTheme=localStorage.getItem("theme")||"light";
document.body.setAttribute("data-bs-theme",savedTheme);
themeBtn.innerHTML=savedTheme==="dark"?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>';
</script>
</body>
</html>