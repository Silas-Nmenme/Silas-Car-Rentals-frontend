<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Enhanced Booking Implementation</title>
    <script src="public/booking-fix-enhanced.js"></script>
</head>
<body>
    <h1>Test Enhanced Booking Implementation</h1>
    <p>Open the browser console to see the test results.</p>
    
    <div style="margin: 2rem 0; padding: 1rem; background: #f5f5f5; border-radius: 8px;">
        <h3>Test Controls</h3>
        <button onclick="runSingleCarTest()" style="margin: 0.5rem;">Test Single Car Booking</button>
        <button onclick="runMultiCarTest()" style="margin: 0.5rem;">Test Multi-Car Booking</button>
        <button onclick="runValidationTest()" style="margin: 0.5rem;">Test Validation</button>
        <button onclick="clearBooking()" style="margin: 0.5rem;">Clear Booking</button>
        <button onclick="viewLocalStorage()" style="margin: 0.5rem;">View LocalStorage</button>
    </div>
    
    <div id="test-results" style="margin: 2rem 0; padding: 1rem; background: #e8f5e8; border-radius: 8px; display: none;">
        <h3>Test Results</h3>
        <pre id="results-content"></pre>
    </div>
    
    <script>
        // Test data
        const testCar = {
            _id: "test-car-123",
            make: "Toyota",
            model: "Camry",
            year: 2023,
            price: 5000,
            image: "https://example.com/car.jpg",
            color: "Black",
            description: "Test car for booking system"
        };

        const testCar2 = {
            _id: "test-car-456",
            make: "Honda",
            model: "Civic",
            year: 2022,
            price: 4500,
            image: "https://example.com/civic.jpg",
            color: "White",
            description: "Another test car"
        };

        function showResults(message) {
            const resultsDiv = document.getElementById('test-results');
            const content = document.getElementById('results-content');
            content.textContent = message;
            resultsDiv.style.display = 'block';
        }

        function runSingleCarTest() {
            console.log("Running Single Car Booking Test...");
            
            const bookingData = {
                userId: "test-user-123",
                car: testCar,
                pickupDate: "2024-01-15",
                returnDate: "2024-01-17",
                email: "test@example.com",
                phoneNumber: "+1234567890",
                source: "test"
            };

            const booking = BookingManager.setBooking(bookingData);
            const retrieved = BookingManager.getBooking();
            const validation = BookingManager.validateBooking(retrieved);

            const result = `
Single Car Booking Test Results:
✅ Booking created: ${!!booking}
✅ Booking retrieved: ${!!retrieved}
✅ Validation passed: ${validation.isValid}
✅ Is multi-car: ${retrieved?.isMultiCar || false}
✅ Car count: ${retrieved?.isMultiCar ? retrieved.cars.length : 1}
✅ Total amount: ₦${retrieved?.totalAmount || 0}
✅ Duration: ${retrieved?.days || 0} days

Booking Details:
${JSON.stringify(retrieved, null, 2)}
            `;

            console.log(result);
            showResults(result);
        }

        function runMultiCarTest() {
            console.log("Running Multi-Car Booking Test...");
            
            const bookingData = {
                userId: "test-user-123",
                cars: [testCar, testCar2],
                pickupDate: "2024-01-15",
                returnDate: "2024-01-17",
                email: "test@example.com",
                phoneNumber: "+1234567890",
                source: "cart"
            };

            const booking = BookingManager.setBooking(bookingData);
            const retrieved = BookingManager.getBooking();
            const validation = BookingManager.validateBooking(retrieved);

            const result = `
Multi-Car Booking Test Results:
✅ Booking created: ${!!booking}
✅ Booking retrieved: ${!!retrieved}
✅ Validation passed: ${validation.isValid}
✅ Is multi-car: ${retrieved?.isMultiCar || false}
✅ Car count: ${retrieved?.isMultiCar ? retrieved.cars.length : 1}
✅ Total amount: ₦${retrieved?.totalAmount || 0}
✅ Duration: ${retrieved?.days || 0} days

Booking Details:
${JSON.stringify(retrieved, null, 2)}
            `;

            console.log(result);
            showResults(result);
        }

        function runValidationTest() {
            console.log("Running Validation Test...");
            
            // Test invalid booking
            const invalidBooking = {
                pickupDate: "2024-01-20",
                returnDate: "2024-01-15", // Invalid: return before pickup
                email: "invalid-email",
                phoneNumber: ""
            };

            const validation = BookingManager.validateBooking(invalidBooking);

            const result = `
Validation Test Results:
✅ Validation result: ${validation.isValid ? 'PASS' : 'FAIL (expected)'}
✅ Error count: ${validation.errors.length}
✅ Errors: ${validation.errors.join(', ')}

Test Details:
- Return date before pickup: ${validation.errors.includes('Return date must be after pickup date') ? '✓' : '✗'}
- Invalid email: ${validation.errors.includes('Valid email is required') ? '✓' : '✗'}
- Missing phone: ${validation.errors.includes('Phone number is required') ? '✓' : '✗'}
            `;

            console.log(result);
            showResults(result);
        }

        function clearBooking() {
            BookingManager.clearBooking();
            const result = "✅ Booking data cleared from localStorage";
            console.log(result);
            showResults(result);
        }

        function viewLocalStorage() {
            const stored = localStorage.getItem('currentBooking');
            const result = `
LocalStorage Contents:
${stored ? JSON.stringify(JSON.parse(stored), null, 2) : 'No booking data found'}
            `;
            console.log(result);
            showResults(result);
        }

        // Run initial test on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Enhanced Booking System Test Suite Loaded");
            console.log("Use the buttons above to run specific tests");
            
            // Check if BookingManager is available
            if (typeof BookingManager !== 'undefined') {
                console.log("✅ BookingManager is properly loaded");
            } else {
                console.log("❌ BookingManager is not available");
            }
        });
    </script>
</body>
</html>
